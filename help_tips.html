<div id="#tips_container">
    <button data-bind="click: demo">Demo </button>
    <div data-bind="with: tour">
        <div class="tip">
            <p data-bind="html: html"> </p>
            <button data-bind="click: close">اغلق</button>
            <button data-bind="click: nextStep, visible: hasNext">الخطوة التالية</button>
            <button data-bind="click: close, visible: !hasNext()">النهاية</button>
        </div>
    </div>
</div>

<script type="text/javascript">
jQuery(function() {
    var TipsViewModel = function() {
        this.tour = ko.observable();

        this.demo = function() {
        var t = new Tour(["مرحبا في موقع اوتار.\n" +
            "تستطيع عن طريق الموقع ان تعزف على المقامات الموسيقية العربية. \nلنأخذ جولة سريعة لنتعلم كيفية استخدام الموقع"
            ,"في الوسط عندنا ازرار العزف و نستطيع من خلالها عزف اي نغمة عن طريق الضغط على ازرار الكيبورد\n" +

            "جرب مثلا الضغط على زر E ثم زر R "
            ]);
            this.tour(t);
        };
        return this;
    };

    var Tour = function(tips) {
        var self = this;
        this.tips = tips
        this.index = ko.observable(0);
        this.html = ko.computed(function() {
            var text = self.tips[self.index()];
            var html = text.replace(/\n/g, "<br>");
            return html;
        });

        this.nextStep = function() {
            console.log("doing next");
            console.log("has next:", self.hasNext())
            self.index(self.index() + 1);
        };
        this.hasNext = ko.computed(function() {
            var i = self.index();
            console.log("index:", i);
            return i < self.tips.length - 1;
        });
        this.close = function() {
            tipsVM.tour(null)
        };
        return this;
    };

    var tipsVM = new TipsViewModel()

    ko.applyBindings(tipsVM, $("#tips_container")[0])
});
</script>
