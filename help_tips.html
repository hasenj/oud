<div id="#tips_container">
    <button data-bind="click: intro"> كيفية العزف </button>
    <div data-bind="with: tour">
        <div class="tip">
            <p data-bind="html: html"> </p>
            <button class="close" data-bind="click: close">اغلق</button>
            <button class="next" data-bind="click: nextStep, visible: hasNext">الخطوة التالية</button>
            <button class="prev" data-bind="click: prevStep, visible: hasPrev">الخطوة السابقة</button>
            <button class="end" data-bind="click: close, visible: !hasNext()">النهاية</button>
        </div>
    </div>
</div>

<script type="text/javascript" src="/tips_data.js"></script>
<script type="text/javascript">
jQuery(function() {
    var TipsViewModel = function() {
        var self = this;
        this.tour = ko.observable();

        this.intro = function() {
            this.tour(new Tour(window.tips_data.intro));
        };

        this.firstTimeIntro = function() {
            var key = "first_time_intro";
            var intro_seen = $.cookie(key)
            intro_seen = false; // XXX HACK DEBUG
            if(!intro_seen) {
                $.cookie(key, 1)
                self.intro();
            }
        };


        return this;
    };

    var Tour = function(tips) {
        var self = this;
        this.tips = tips
        this.index = ko.observable(0);
        this.html = ko.computed(function() {
            var text = self.tips[self.index()];
            var html = text.replace(/\n/g, "<br>");
            return html;
        });

        this.nextStep = function() {
            self.index(self.index() + 1);
        };
        this.hasNext = ko.computed(function() {
            var nextIndex = self.index() + 1;
            return nextIndex < self.tips.length;
        });
        this.prevStep = function() {
            self.index(self.index() - 1);
        };
        this.hasPrev = ko.computed(function() {
            var prevIndex = self.index() - 1;
            return prevIndex >= 0;
        });
        this.close = function() {
            tipsVM.tour(null)
        };
        return this;
    };

    var tipsVM = new TipsViewModel();

    ko.applyBindings(tipsVM, $("#tips_container")[0])

    tipsVM.firstTimeIntro();
});
</script>
